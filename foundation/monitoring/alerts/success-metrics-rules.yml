# ARES ChronoSynclastic Fabric - Success Metrics Recording Rules
# Pre-computed queries for dashboard performance and SLA tracking

groups:
  - name: csf_success_metrics_recording
    interval: 30s
    rules:
      # Core Performance KPIs
      - record: csf:latency_p95_1m
        expr: histogram_quantile(0.95, rate(csf_time_source_query_duration_ns_bucket[1m]))
        labels:
          metric_type: "performance"
          sla_target: "1000ns"

      - record: csf:latency_p99_1m  
        expr: histogram_quantile(0.99, rate(csf_time_source_query_duration_ns_bucket[1m]))
        labels:
          metric_type: "performance"
          sla_target: "2000ns"

      - record: csf:throughput_1m
        expr: rate(csf_bus_messages_processed_total[1m])
        labels:
          metric_type: "throughput"
          sla_target: "1000000"

      # SLA Compliance Metrics
      - record: csf:uptime_availability_24h
        expr: avg_over_time(csf_uptime_ratio[24h])
        labels:
          metric_type: "availability" 
          sla_target: "0.9999"

      - record: csf:error_rate_1h
        expr: rate(csf_error_rate_ratio[1h])
        labels:
          metric_type: "reliability"
          sla_target: "0.0001"

      # Temporal Coherence Success Rate
      - record: csf:temporal_coherence_success_rate_1h
        expr: (1 - (rate(csf_causality_violations_total[1h]) / rate(csf_time_operations_total[1h])))
        labels:
          metric_type: "coherence"
          sla_target: "0.99999"

  - name: csf_business_metrics
    interval: 5m
    rules:
      # Customer Success Metrics
      - record: csf:customer_pilot_performance_improvement_ratio
        expr: (csf_pilot_performance_after - csf_pilot_performance_before) / csf_pilot_performance_before
        labels:
          metric_type: "business_value"
          target: "0.20"  # >20% improvement target

      # Hardware Efficiency Metrics
      - record: csf:hardware_efficiency_score
        expr: (csf_gpu_utilization_percent * csf_mlir_backend_efficiency_ratio * csf_data_transfer_efficiency_ratio) / 100
        labels:
          metric_type: "efficiency"
          target: "0.85"  # >85% combined efficiency

      # Investment Validation Metrics (Weekly)
  - name: csf_investment_validation
    interval: 1h
    rules:
      - record: csf:technical_milestone_completion_rate_weekly
        expr: sum(increase(csf_milestone_completed_total[7d])) / sum(increase(csf_milestone_planned_total[7d]))
        labels:
          metric_type: "development_velocity"
          target: "0.80"  # 80% on-time completion

      - record: csf:defect_density_weekly
        expr: sum(increase(csf_defects_total[7d])) / sum(increase(csf_features_delivered_total[7d]))
        labels:
          metric_type: "quality"
          target: "0.05"  # <5% defect rate

      - record: csf:patent_portfolio_value_estimate
        expr: csf_patent_applications_filed * 2000000 + csf_patent_applications_granted * 5000000
        labels:
          metric_type: "intellectual_property"
          target: "27000000"  # $27M target IP value