groups:
  - name: ares-chronofabric-enterprise-alerts
    rules:
      # Business KPI Alerts
      - alert: BusinessKPIViolation
        expr: business_sla_compliance_score < 95
        for: 2m
        labels:
          severity: critical
          team: business
          category: sla
        annotations:
          summary: "Business SLA compliance below target"
          description: "SLA compliance score is {{ $value }}%, below 95% target"
          runbook_url: "https://docs.ares-systems.com/runbooks/business-sla"

      - alert: RevenuePerOperationDrop
        expr: rate(business_revenue_per_operation[5m]) < 0.0008
        for: 5m
        labels:
          severity: warning
          team: business
          category: revenue
        annotations:
          summary: "Revenue per operation below target"
          description: "Revenue per operation is ${{ $value }}, below $0.001 target"

      # Quantum Operations Alerts
      - alert: QuantumCoherenceLoss
        expr: quantum_coherence_ratio < 0.90
        for: 1m
        labels:
          severity: critical
          team: quantum
          category: coherence
        annotations:
          summary: "Quantum coherence loss detected"
          description: "Quantum coherence ratio dropped to {{ $value }}, below 90% threshold"
          runbook_url: "https://docs.ares-systems.com/runbooks/quantum-coherence"

      - alert: QuantumGateLatencyHigh
        expr: histogram_quantile(0.95, quantum_gate_operation_time_bucket) > 0.0005
        for: 2m
        labels:
          severity: warning
          team: quantum
          category: performance
        annotations:
          summary: "Quantum gate operations are slow"
          description: "95th percentile gate operation time is {{ $value }}s, above 500Î¼s threshold"

      - alert: QuantumEntanglementEntropy
        expr: quantum_entanglement_entropy > 8.0
        for: 3m
        labels:
          severity: warning
          team: quantum
          category: entropy
        annotations:
          summary: "High quantum entanglement entropy"
          description: "Entanglement entropy is {{ $value }}, indicating potential decoherence"

      # Performance SLA Alerts
      - alert: LatencySLAViolation
        expr: histogram_quantile(0.95, sla_latency_p95_bucket) > 0.001
        for: 2m
        labels:
          severity: critical
          team: sre
          category: sla
        annotations:
          summary: "Latency SLA violation"
          description: "95th percentile latency is {{ $value }}s, exceeding 1ms SLA"
          runbook_url: "https://docs.ares-systems.com/runbooks/latency-sla"

      - alert: ThroughputSLAViolation
        expr: rate(sla_throughput_target[5m]) < 800000
        for: 3m
        labels:
          severity: critical
          team: sre
          category: sla
        annotations:
          summary: "Throughput SLA violation"
          description: "Throughput is {{ $value }} ops/sec, below 1M ops/sec SLA"

      - alert: AvailabilitySLAViolation
        expr: sla_availability_target < 99.9
        for: 1m
        labels:
          severity: critical
          team: sre
          category: sla
        annotations:
          summary: "Availability SLA violation"
          description: "System availability is {{ $value }}%, below 99.9% SLA"

      # Security & Compliance Alerts
      - alert: SecurityComplianceViolation
        expr: security_scan_score < 85
        for: 5m
        labels:
          severity: high
          team: security
          category: compliance
        annotations:
          summary: "Security compliance score below threshold"
          description: "Security scan score is {{ $value }}, below 85 threshold"
          runbook_url: "https://docs.ares-systems.com/runbooks/security-compliance"

      - alert: CriticalVulnerabilityDetected
        expr: vulnerability_count_critical > 0
        for: 0s
        labels:
          severity: emergency
          team: security
          category: vulnerability
        annotations:
          summary: "Critical security vulnerability detected"
          description: "{{ $value }} critical vulnerabilities found in system"
          runbook_url: "https://docs.ares-systems.com/runbooks/critical-vulnerabilities"

      - alert: SOC2ComplianceViolation
        expr: compliance_soc2_score < 90
        for: 10m
        labels:
          severity: high
          team: compliance
          category: soc2
        annotations:
          summary: "SOC 2 compliance score below threshold"
          description: "SOC 2 compliance score is {{ $value }}%, below 90% requirement"

      # System Resource Alerts
      - alert: HighCPUUsage
        expr: system_cpu_usage_percent > 85
        for: 5m
        labels:
          severity: warning
          team: sre
          category: resources
        annotations:
          summary: "High CPU usage detected"
          description: "CPU usage is {{ $value }}%, above 85% threshold"

      - alert: HighMemoryUsage
        expr: system_memory_usage_bytes / (1024*1024*1024) > 14
        for: 5m
        labels:
          severity: warning
          team: sre
          category: resources
        annotations:
          summary: "High memory usage detected"
          description: "Memory usage is {{ $value }}GB, above 14GB threshold"

      - alert: MemoryLeakDetection
        expr: increase(system_memory_usage_bytes[30m]) > 1073741824
        for: 5m
        labels:
          severity: critical
          team: sre
          category: memory-leak
        annotations:
          summary: "Potential memory leak detected"
          description: "Memory usage increased by {{ $value }} bytes in 30 minutes"

      # Cost Optimization Alerts
      - alert: CostBudgetExceeded
        expr: cost_budget_utilization > 90
        for: 10m
        labels:
          severity: warning
          team: finops
          category: cost
        annotations:
          summary: "Cost budget utilization high"
          description: "Cost budget utilization is {{ $value }}%, approaching limit"

      - alert: InfrastructureWaste
        expr: resource_waste_percentage > 25
        for: 15m
        labels:
          severity: warning
          team: finops
          category: efficiency
        annotations:
          summary: "High infrastructure waste detected"
          description: "{{ $value }}% of resources are wasted, above 25% threshold"

      - alert: EnergyEfficiencyLow
        expr: energy_efficiency_ratio < 0.80
        for: 10m
        labels:
          severity: warning
          team: sustainability
          category: energy
        annotations:
          summary: "Energy efficiency below target"
          description: "Energy efficiency ratio is {{ $value }}, below 80% target"

      # User Experience Alerts
      - alert: UserSatisfactionDrop
        expr: user_satisfaction_score < 7.0
        for: 5m
        labels:
          severity: warning
          team: product
          category: user-experience
        annotations:
          summary: "User satisfaction score declining"
          description: "User satisfaction score is {{ $value }}, below 7.0 threshold"

      - alert: HighUserErrorRate
        expr: rate(user_error_rate[5m]) > 0.05
        for: 3m
        labels:
          severity: warning
          team: product
          category: user-experience
        annotations:
          summary: "High user error rate detected"
          description: "User error rate is {{ $value }}, above 5% threshold"

      # Network & Communication Alerts
      - alert: NetworkErrorRateHigh
        expr: rate(csf_network_errors_total[5m]) > 0.1
        for: 2m
        labels:
          severity: critical
          team: network
          category: errors
        annotations:
          summary: "High network error rate"
          description: "Network error rate is {{ $value }} errors/sec, above 0.1 threshold"

      - alert: ConsensusLatencyHigh
        expr: histogram_quantile(0.95, consensus_round_duration_seconds_bucket) > 0.1
        for: 3m
        labels:
          severity: warning
          team: consensus
          category: performance
        annotations:
          summary: "Consensus rounds taking too long"
          description: "95th percentile consensus latency is {{ $value }}s, above 100ms threshold"

      # Enterprise Grade Alerts
      - alert: ServiceMeshConnectivityIssue
        expr: istio_requests_total{response_code!~"2.*"} / istio_requests_total > 0.05
        for: 2m
        labels:
          severity: critical
          team: platform
          category: service-mesh
        annotations:
          summary: "Service mesh connectivity issues"
          description: "{{ $value }}% of service mesh requests are failing"

      - alert: CertificateExpiringSoon
        expr: (ssl_certificate_expiry_timestamp - time()) / 86400 < 30
        for: 1m
        labels:
          severity: warning
          team: security
          category: certificates
        annotations:
          summary: "SSL certificate expiring soon"
          description: "Certificate expires in {{ $value }} days"

      - alert: HelmDeploymentFailed
        expr: kube_deployment_status_replicas_available / kube_deployment_spec_replicas < 0.8
        for: 5m
        labels:
          severity: critical
          team: platform
          category: deployment
        annotations:
          summary: "Deployment replica availability low"
          description: "Only {{ $value }}% of deployment replicas are available"

  - name: recording-rules
    rules:
      # Business KPI Recording Rules
      - record: business:sla_compliance:rate5m
        expr: avg_over_time(business_sla_compliance_score[5m])

      - record: business:revenue_efficiency:rate1h
        expr: rate(business_revenue_per_operation[1h]) * 3600

      - record: business:customer_satisfaction:avg24h
        expr: avg_over_time(user_satisfaction_score[24h])

      # Quantum Performance Recording Rules
      - record: quantum:coherence:avg5m
        expr: avg_over_time(quantum_coherence_ratio[5m])

      - record: quantum:operations:rate5m
        expr: rate(quantum_gate_operations_total[5m])

      - record: quantum:latency:p95_5m
        expr: histogram_quantile(0.95, rate(quantum_gate_operation_time_bucket[5m]))

      # System Performance Recording Rules
      - record: system:latency:p95_5m
        expr: histogram_quantile(0.95, rate(sla_latency_p95_bucket[5m]))

      - record: system:throughput:rate5m
        expr: rate(sla_throughput_target[5m])

      - record: system:availability:rate24h
        expr: avg_over_time(sla_availability_target[24h])

      # Cost Efficiency Recording Rules
      - record: cost:efficiency:rate1h
        expr: avg_over_time(cost_efficiency_ratio[1h])

      - record: cost:waste:rate1h
        expr: avg_over_time(resource_waste_percentage[1h])

      # Security Recording Rules
      - record: security:score:avg1h
        expr: avg_over_time(security_scan_score[1h])

      - record: security:violations:rate5m
        expr: rate(access_control_violations[5m])

      # Infrastructure Recording Rules
      - record: infrastructure:cpu:avg5m
        expr: avg_over_time(system_cpu_usage_percent[5m])

      - record: infrastructure:memory:avg5m
        expr: avg_over_time(system_memory_usage_bytes[5m]) / (1024*1024*1024)

      - record: infrastructure:network:rate5m
        expr: rate(system_network_bytes_total[5m])

# Enterprise alerting rules with escalation
  - name: enterprise-escalation-alerts
    rules:
      - alert: EnterpriseSystemDown
        expr: up{job="ares-csf-core"} == 0
        for: 30s
        labels:
          severity: emergency
          escalation: immediate
          team: sre
          category: availability
        annotations:
          summary: "ARES ChronoFabric system is down"
          description: "Primary system is unreachable for 30+ seconds"
          action_required: "Immediate investigation and recovery"
          escalation_policy: "page_cto_after_5min"

      - alert: QuantumOracleUnavailable
        expr: quantum_oracle_available == 0
        for: 1m
        labels:
          severity: emergency
          escalation: immediate
          team: quantum
          category: oracle
        annotations:
          summary: "Quantum Oracle is unavailable"
          description: "Quantum optimization oracle is not responding"
          action_required: "Restore quantum oracle functionality"
          escalation_policy: "page_quantum_team_lead"

      - alert: DataIntegrityCompromised
        expr: increase(data_integrity_violations_total[5m]) > 0
        for: 0s
        labels:
          severity: emergency
          escalation: immediate
          team: security
          category: data-integrity
        annotations:
          summary: "Data integrity compromise detected"
          description: "{{ $value }} data integrity violations in the last 5 minutes"
          action_required: "Immediate security response and investigation"
          escalation_policy: "page_ciso_immediately"

      - alert: ComplianceFrameworkFailure
        expr: min(compliance_soc2_score, compliance_iso27001_score) < 75
        for: 15m
        labels:
          severity: high
          escalation: business_hours
          team: compliance
          category: regulatory
        annotations:
          summary: "Compliance framework score critically low"
          description: "Minimum compliance score is {{ $value }}%, below 75% critical threshold"
          action_required: "Review and remediate compliance violations"
          escalation_policy: "notify_compliance_officer"

      - alert: BusinessContinuityRisk
        expr: (
          (system:availability:rate24h < 99.9) or
          (business:revenue_efficiency:rate1h < 0.0005) or
          (quantum:coherence:avg5m < 0.85)
        )
        for: 10m
        labels:
          severity: critical
          escalation: business_hours
          team: executive
          category: business-continuity
        annotations:
          summary: "Business continuity risk detected"
          description: "Multiple critical KPIs indicate business continuity risk"
          action_required: "Executive team notification and risk assessment"
          escalation_policy: "notify_executive_team"

# Multi-dimensional alerting based on business impact
  - name: business-impact-alerts
    rules:
      - alert: HighBusinessImpactIncident
        expr: |
          (
            (quantum:coherence:avg5m < 0.80) and
            (rate(business_revenue_per_operation[15m]) < 0.0005)
          ) or (
            (system:latency:p95_5m > 0.005) and
            (user_satisfaction_score < 6.0)
          )
        for: 5m
        labels:
          severity: critical
          business_impact: high
          escalation: immediate
          team: incident_response
        annotations:
          summary: "High business impact incident detected"
          description: "Multiple indicators suggest significant business impact"
          action_required: "Activate incident response team"
          estimated_revenue_impact: "$10,000/hour"

      - alert: CustomerExperienceDegradation
        expr: |
          (
            (system:latency:p95_5m > 0.002) or
            (rate(user_error_rate[10m]) > 0.03) or
            (user_satisfaction_score < 7.5)
          )
        for: 8m
        labels:
          severity: warning
          business_impact: medium
          team: customer_success
        annotations:
          summary: "Customer experience degradation detected"
          description: "User experience metrics indicate service degradation"
          action_required: "Investigate user-facing performance issues"

# Cost and efficiency alerting
  - name: enterprise-cost-alerts
    rules:
      - alert: UnexpectedCostSpike
        expr: increase(cost_budget_utilization[1h]) > 15
        for: 0s
        labels:
          severity: warning
          team: finops
          category: cost-anomaly
        annotations:
          summary: "Unexpected cost increase detected"
          description: "Cost utilization increased by {{ $value }}% in the last hour"
          action_required: "Investigate cost drivers and optimize resource usage"

      - alert: InefficiencyThresholdBreached
        expr: resource_waste_percentage > 30
        for: 20m
        labels:
          severity: warning
          team: finops
          category: efficiency
        annotations:
          summary: "Resource efficiency below acceptable levels"
          description: "{{ $value }}% of resources are wasted, above 30% threshold"
          action_required: "Review and optimize resource allocation"

# Proactive health monitoring
  - name: proactive-health-monitoring
    rules:
      - alert: SystemHealthDegrading
        expr: |
          (
            (increase(system_cpu_usage_percent[10m]) > 20) or
            (increase(system_memory_usage_bytes[10m]) > 2147483648) or
            (rate(csf_network_errors_total[5m]) > 0.05)
          )
        for: 3m
        labels:
          severity: warning
          team: sre
          category: proactive-health
        annotations:
          summary: "System health indicators suggest potential issues"
          description: "Multiple system health metrics show degradation patterns"
          action_required: "Proactive investigation to prevent service impact"

      - alert: QuantumStateStabilityRisk
        expr: |
          (
            (stddev_over_time(quantum_coherence_ratio[15m]) > 0.1) or
            (increase(quantum_decoherence_rate[10m]) > 0.05)
          )
        for: 5m
        labels:
          severity: warning
          team: quantum
          category: stability
        annotations:
          summary: "Quantum state stability at risk"
          description: "Quantum state metrics show instability patterns"
          action_required: "Review quantum state management and environmental factors"